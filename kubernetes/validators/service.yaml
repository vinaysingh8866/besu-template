---
apiVersion: v1
kind: Service
metadata:
  name: besu-validator
  namespace: besu-network
  labels:
    app: besu-validator
    network: Besu
spec:
  type: ClusterIP
  clusterIP: None  # Headless service for StatefulSet
  selector:
    app: besu-validator
  ports:
    - name: discovery
      port: 30303
      targetPort: 30303
      protocol: UDP
    - name: rlpx
      port: 30303
      targetPort: 30303
      protocol: TCP
    - name: metrics
      port: 9545
      targetPort: 9545
      protocol: TCP
---
# External RPC service (exposes validator-0 RPC)
apiVersion: v1
kind: Service
metadata:
  name: besu-validator-rpc
  namespace: besu-network
  labels:
    app: besu-validator
    network: Besu
spec:
  type: NodePort
  selector:
    app: besu-validator
    statefulset.kubernetes.io/pod-name: besu-validator-0
  ports:
    - name: http-rpc
      port: 8545
      targetPort: 8545
      nodePort: 30545
      protocol: TCP
    - name: ws-rpc
      port: 8546
      targetPort: 8546
      nodePort: 30546
      protocol: TCP
